export default class{constructor(e){this.$el=e,this.menu=document.querySelector("#menu"),this.mobile=document.querySelector("button[aria-controls]"),this.isOpen=!1,this.dropdowns=this.menu.querySelectorAll(".menu-item.has-dropdown"),this.current=null,this.handleGlobalClickForMobileMenuBound=this.handleGlobalClickForMobileMenu.bind(this),this.handleGlobalEventForSubmenusBound=this.handleGlobalEventForSubmenus.bind(this),this.media=matchMedia("(min-width: 56em)"),this.media.addListener(this.toggleDesktopAndMobileMenu.bind(this)),this.init()}init(){this.mobile.addEventListener("click",e=>{e.preventDefault(),this.toggleMobilePopup()});for(let e=0,t=this.dropdowns.length;e<t;e++){const t=this.dropdowns[e],n=t.querySelector("a");n.addEventListener("touchend",e=>{this.isDesktop()&&(e.preventDefault(),this.toggleDropdown(t))}),n.addEventListener("mouseenter",e=>{this.isDesktop()&&this.toggleDropdown(t,!0)}),n.addEventListener("focus",e=>{this.isDesktop()&&this.toggleDropdown(t,!0)}),t.addEventListener("mouseleave",e=>{this.isDesktop()&&this.toggleDropdown(t,!1)})}this.toggleDesktopAndMobileMenu()}handleGlobalEventForSubmenus(e){null!==this.current&&!1===this.current.contains(e.target)&&this.toggleDropdown(this.current,!1)}toggleDesktopAndMobileMenu(){this.isDesktop()?(this.mobile.setAttribute("aria-hidden","true"),this.mobile.hidden=!0):(this.mobile.removeAttribute("aria-hidden"),this.mobile.hidden=!1)}isDesktop(){return this.media.matches}closeAllSubmenus(){for(let e=0,t=this.dropdowns.length;e<t;e++){const t=this.dropdowns[e];this.toggleDropdown(t,!1)}}toggleDropdown(e,t){let n=!e.classList.contains("is-open");if(void 0!==t){if(t!==n)return;n=t}if(!0===n)for(let e=0,t=this.dropdowns.length;e<t;e++){const t=this.dropdowns[e];this.toggleDropdown(t,!1)}e.classList.toggle("is-open",n),null===this.current&&(window.addEventListener("focusin",this.handleGlobalEventForSubmenusBound),document.body.addEventListener("click",this.handleGlobalEventForSubmenusBound),document.body.addEventListener("touchstart",this.handleGlobalEventForSubmenusBound)),this.current=n?e:null,null===this.current&&(window.removeEventListener("focusin",this.handleGlobalEventForSubmenusBound),document.body.removeEventListener("click",this.handleGlobalEventForSubmenusBound),document.body.removeEventListener("touchstart",this.handleGlobalEventForSubmenusBound))}toggleMobilePopup(e){let t=!this.isOpen;if(void 0!==e){if(e===this.isOpen)return;t=e}this.mobile.setAttribute("aria-expanded",t?"true":"false"),this.mobile.setAttribute("aria-label",t?"Close menu":"Open menu"),setTimeout(()=>{t?window.addEventListener("click",this.handleGlobalClickForMobileMenuBound):window.removeEventListener("click",this.handleGlobalClickForMobileMenuBound)},0),this.isOpen=t}handleGlobalClickForMobileMenu(e){this.menu.contains(e.target)||(e.preventDefault(),this.toggleMobilePopup(!1))}}